
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>黃金切割率</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    table.two-col th { width: 100px; white-space: nowrap; }
    table.two-col td { width: auto; }
    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); border: 0;
    }
  </style>
</head>
<body>
  <main class="container">
    <h1 class="page-title">黃金切割率</h1>

    <section class="card">
      <div class="row">
        <label for="lowest">值1</label>
        <input id="lowest" type="number" step="0.01" placeholder="輸入第1個值" />
      </div>
      <div class="row">
        <label for="highest">值2</label>
        <input id="highest" type="number" step="0.01" placeholder="輸入第2個值" />
      </div>

      <div class="table-wrap">
        <table class="two-col">
          <tbody>
            <tr>
              <th>係數 k</th>
              <td>
                <span id="target-title">反彈目標</span>
                <span id="targetresult" class="mono sr-only">--</span>
              </td>
            </tr>
            <tr>
              <th>0.382</th>
              <td><span id="v-0.382" class="mono">--</span></td>
            </tr>
            <tr>
              <th>0.5</th>
              <td><span id="v-0.5" class="mono">--</span></td>
            </tr>
            <tr>
              <th>0.618</th>
              <td><span id="v-0.618" class="mono">--</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="actions">
        <button id="btn-copy" type="button">複製</button>
        <span id="copied-msg" class="muted" aria-live="polite"></span>
      </div>
    </section>
  </main>

  <script>
    function round2(n) {
      if (!isFinite(n)) return '--';
      return (Math.round(n * 100) / 100).toFixed(2);
    }

    function computeGeom(low, high, k) {
      return Math.pow(low, (1 - k)) * Math.pow(high, k);
    }

    function recalc() {
      const lowest = parseFloat(document.getElementById('lowest').value);
      const highest = parseFloat(document.getElementById('highest').value);

      const titleEl = document.getElementById('target-title');
      const targetEl = document.getElementById('targetresult');
      const v382El = document.getElementById('v-0.382');
      const v50El = document.getElementById('v-0.5');
      const v618El = document.getElementById('v-0.618');

      if (isFinite(lowest) && isFinite(highest)) {
        titleEl.textContent = (lowest <= highest) ? '反彈目標' : '修正目標';
      } else {
        titleEl.textContent = '反彈目標';
      }

      let v382 = NaN, v50 = NaN, v618 = NaN;
      if (isFinite(lowest) && isFinite(highest)) {
        v382 = computeGeom(lowest, highest, 0.382);
        v50  = computeGeom(lowest, highest, 0.5);
        v618 = computeGeom(lowest, highest, 0.618);
      }
      v382El.textContent = round2(v382);
      v50El.textContent  = round2(v50);
      v618El.textContent = round2(v618);

      // 存一個參考值（用0.618的值）
      targetEl.textContent = round2(v618);
    }

    async function copyBundle() {
      const t    = document.getElementById('target-title').textContent.trim();
      const v382 = document.getElementById('v-0.382').textContent.trim();
      const v50  = document.getElementById('v-0.5').textContent.trim();
      const v618 = document.getElementById('v-0.618').textContent.trim();

      const payload = `${t}\n0.382=${v382}\n0.5=${v50}\n0.618=${v618}`;

      try {
        await navigator.clipboard.writeText(payload);
        showCopied('已複製到剪貼簿！');
      } catch (err) {
        const ta = document.createElement('textarea');
        ta.value = payload;
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand('copy');
          showCopied('已複製到剪貼簿！');
        } catch (e) {
          showCopied('複製失敗，請手動選取。');
        } finally {
          document.body.removeChild(ta);
        }
      }
    }

    function showCopied(msg) {
      const el = document.getElementById('copied-msg');
      el.textContent = msg;
      setTimeout(() => el.textContent = '', 2000);
    }

    document.getElementById('lowest').addEventListener('input', recalc);
    document.getElementById('highest').addEventListener('input', recalc);
    document.getElementById('btn-copy').addEventListener('click', copyBundle);

    recalc();
  </script>
</body>
</html>
